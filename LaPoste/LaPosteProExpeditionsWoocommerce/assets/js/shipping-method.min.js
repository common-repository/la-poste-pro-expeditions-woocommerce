"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(){var e={};e.ratesTable={trigger:"#laposteproexp-rates-table",init:function(){var e=document.querySelector(this.trigger),t=this;null!==e&&(t.on("body","click",".laposteproexp-add-rate-line",function(e){e.preventDefault();var r=new XMLHttpRequest;r.onreadystatechange=function(e){if(4===r.readyState)if(200===r.status){var n="object"===_typeof(r.response)&&null!==r.response?r.response.data:JSON.parse(r.response).data;t.getTableBody().insertAdjacentHTML("beforeend",n),t.initSelect("#laposteproexp-rates-table tbody tr:last-child select.laposteproexp-tom-select")}else console.log("Error: "+r.status)},r.open("POST",laposteproexpData.ajaxurl),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),r.responseType="json";var n="action="+e.target.getAttribute("data-action")+"&security="+encodeURIComponent(laposteproexpData.shippingMethodAjaxNonce),o=t.getTableRows();if(null!==o){var l=o[o.length-1],a=[];t.parseNodeChildrenSpecificTypeAction(l,["SELECT","INPUT"],function(e){if("SELECT"===e.tagName){var r=e.getAttribute("name"),n=t.getSelectedOptions(e);n.length>0?n.map(function(e){a.push(r+"="+encodeURIComponent(e.value))}):a.push(r+"=")}else a.push(e.getAttribute("name")+"="+encodeURIComponent(e.value))}),n+="&"+a.join("&")}r.send(n)}),t.on("body","click",".laposteproexp-remove-rate-line",function(e){e.preventDefault();var t=document.querySelector(".pricing-item.last_selected");null!==t&&t.remove()}),t.on("body","click",".laposteproexp-remove-line",function(e){e.preventDefault();var r=t.getParentRow(e.target);null!==r&&r.remove()}),t.on("body","change",".laposteproexp-change-state",function(e,r){var n=null!==e.target&&!1===e.target.checked,o=t.getParentRow(e.target);null!==o&&t.setRowState(o,n)}),t.initSelect("select.laposteproexp-tom-select"),t.submitForm=t.submitForm.bind(t),document.getElementById("mainform").addEventListener("submit",t.submitForm))},getParentRow:function(e){for(;null!==e&&e!==undefined&&"tr"!==e.tagName.toLowerCase();)e=e.parentNode;return e===undefined?null:e},setRowState:function(e,t){var r=e.querySelectorAll('input[type="text"], input[type="number"], select'),n=!0,o=!1,l=undefined;try{for(var a,i=r[Symbol.iterator]();!(n=(a=i.next()).done);n=!0){a.value.disabled=t}}catch(u){o=!0,l=u}finally{try{!n&&i["return"]&&i["return"]()}finally{if(o)throw l}}this.initSelect("#laposteproexp-rates-table select.laposteproexp-tom-select"),t?e.classList.add("disabled"):e.classList.remove("disabled")},getSelectedOptions:function(e,t){for(var r,n=[],o=0,l=e.options.length;o<l;o++)(r=e.options[o]).selected&&(n.push(r),t&&t(r));return n},submitForm:function(e){e.preventDefault();var t=[],r=document.querySelectorAll(".pricing-item");if(r.length>0)for(var n=0;n<r.length;n++){var o=r[n],l=o.querySelector("td .state"),a=l.checked?l.getAttribute("data-checked"):l.getAttribute("data-unchecked"),i=o.querySelector("td .shipping-class"),u={"price-from":o.querySelector("td .price-from").value,"price-to":o.querySelector("td .price-to").value,"weight-from":o.querySelector("td .weight-from").value,"weight-to":o.querySelector("td .weight-to").value,"shipping-class":null===i?[]:Array.apply(null,i.options).filter(function(e){return e.selected}).map(function(e){return e.value}),"parcel-point-network":Array.apply(null,o.querySelector("td .parcel-point-network").options).filter(function(e){return e.selected}).map(function(e){return e.value}),pricing:a,"flat-rate":o.querySelector("td .flat-rate").value,state:o.querySelector("td .state").checked};t.push(u)}var c=document.createElement("input");c.setAttribute("type","hidden"),c.setAttribute("name","pricing-items"),c.value=JSON.stringify(t);var s=document.createElement("input");return s.setAttribute("type","hidden"),s.setAttribute("name","save"),s.value=1,document.querySelector(this.trigger).appendChild(c),document.querySelector(this.trigger).appendChild(s),document.getElementById("mainform").removeEventListener("submit",this.submitForm),document.getElementById("mainform").submit(),!0},initSelect:function(e){for(var t=document.querySelectorAll(e),r=0;r<t.length;r++){var n=t[r];n.tomselect?n.disabled?n.tomselect.disable():n.tomselect.enable():new TomSelect(t[r],{plugins:["remove_button"]})}},getTableBody:function(){var e=document.querySelector(this.trigger).querySelector("tbody");return null===e?null:e},getTableRows:function(){var e=this.getTableBody();return null===e?null:0===e.childElementCount?null:e.children},parseNodeChildrenSpecificTypeAction:function(e,t,r){if(e.hasChildNodes())for(var n=e.childNodes,o=0;o<n.length;o++){var l=n[o];-1!==t.indexOf(l.tagName)&&r(l),this.parseNodeChildrenSpecificTypeAction(l,t,r)}return e},on:function(e,t,r,n){var o=document.querySelector(e);o.addEventListener(t,function(e){for(var t=o.querySelectorAll(r),l=e.target,a=0,i=t.length;a<i;a++)for(var u=l,c=t[a];u&&u!==o;){if(u===c)return n.call(c,e);u=u.parentNode}})}},document.addEventListener("DOMContentLoaded",function(){e.ratesTable.init()})}();